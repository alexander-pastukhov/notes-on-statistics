<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 17 Multiple regression - Masked relationship | Notes on Statistics</title>
<meta name="author" content="Alexander Pastukhov">
<meta name="description" content="These notes are on section 5.2 “Masked relationship” from chapter 5 “The Many Variables &amp; The Spurious Waffles”. This section introduces is a mirror twin of section 5.1 on spurious associations....">
<meta name="generator" content="bookdown 0.26 with bs4_book()">
<meta property="og:title" content="Chapter 17 Multiple regression - Masked relationship | Notes on Statistics">
<meta property="og:type" content="book">
<meta property="og:description" content="These notes are on section 5.2 “Masked relationship” from chapter 5 “The Many Variables &amp; The Spurious Waffles”. This section introduces is a mirror twin of section 5.1 on spurious associations....">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 17 Multiple regression - Masked relationship | Notes on Statistics">
<meta name="twitter:description" content="These notes are on section 5.2 “Masked relationship” from chapter 5 “The Many Variables &amp; The Spurious Waffles”. This section introduces is a mirror twin of section 5.1 on spurious associations....">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="bs4_style.css%20-%20style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Notes on Statistics</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Precis</a></li>
<li><a class="" href="loss-functions.html"><span class="header-section-number">2</span> Loss functions</a></li>
<li><a class="" href="directed-acyclic-graphs-and-causal-reasoning.html"><span class="header-section-number">3</span> Directed Acyclic Graphs and Causal Reasoning</a></li>
<li><a class="" href="spurious-association.html"><span class="header-section-number">4</span> Multiple regression - Spurious association</a></li>
<li><a class="" href="the-haunted-dag.html"><span class="header-section-number">5</span> The haunted DAG</a></li>
<li><a class="" href="information-criteria.html"><span class="header-section-number">6</span> Information Criteria</a></li>
<li><a class="" href="bayesian-vs.-fequentist-statisics.html"><span class="header-section-number">7</span> Bayesian vs. fequentist statisics</a></li>
<li><a class="" href="mixtures.html"><span class="header-section-number">8</span> Mixtures</a></li>
<li><a class="" href="instrumental-variables.html"><span class="header-section-number">9</span> Instrumental Variables</a></li>
<li><a class="" href="parameters-combining-information-from-an-individual-with-population.html"><span class="header-section-number">10</span> Parameters: combining information from an individual with population</a></li>
<li><a class="" href="incorporating-measurement-error-a-rubber-band-metaphor.html"><span class="header-section-number">11</span> Incorporating measurement error: a rubber band metaphor</a></li>
<li><a class="" href="generalized-additive-models-as-continuous-random-effects.html"><span class="header-section-number">12</span> Generalized Additive Models as continuous random effects</a></li>
<li><a class="" href="flat-priors-the-strings-attached.html"><span class="header-section-number">13</span> Flat priors: the strings attached</a></li>
<li><a class="" href="unbiased-mean-versus-biased-variance-in-plain-english.html"><span class="header-section-number">14</span> Unbiased mean versus biased variance in plain English</a></li>
<li><a class="" href="probability-mass-versus-probability-density.html"><span class="header-section-number">15</span> Probability mass versus probability density</a></li>
<li><a class="" href="effective-degrees-of-freedom-number-of-parameters.html"><span class="header-section-number">16</span> Effective degrees of freedom / number of parameters</a></li>
<li><a class="active" href="multiple-regression---masked-relationship.html"><span class="header-section-number">17</span> Multiple regression - Masked relationship</a></li>
<li><a class="" href="ordered-categorical-data-i.e.-likert-scales.html"><span class="header-section-number">18</span> Ordered Categorical Data, i.e., Likert-scales</a></li>
<li><a class="" href="intuition-for-how-cholesky-decomposition-makes-possible-to-generate-correlated-random-variables.html"><span class="header-section-number">19</span> Intuition for how Cholesky decomposition makes possible to generate correlated random variables</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/alexander-pastukhov/notes-on-statistics">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="multiple-regression---masked-relationship" class="section level1" number="17">
<h1>
<span class="header-section-number">17</span> Multiple regression - Masked relationship<a class="anchor" aria-label="anchor" href="#multiple-regression---masked-relationship"><i class="fas fa-link"></i></a>
</h1>
<p>These notes are on section 5.2 “Masked relationship” from chapter 5 “The Many Variables &amp; The Spurious Waffles”. This section introduces is a mirror twin of section 5.1 on <a href="spurious-association.html#spurious-association">spurious associations</a>. The latter explores how each of two predictors can have a strong relationship with an outcome variable <em>if fitted individually</em> but how only one of them retains that relationship when both predictors are used in multiple regression. Section 5.2 is concerned with the exact opposite. When we look at the association between each predictor variable (<em>neocortex percent</em> and <em>log body mass</em>) and the richness of milk <em>individually</em>, we find nothing. However, when you use <em>both</em> simultaneously via multiple regression, we find that both are strongly associated with the outcome variable.</p>
<p>The key to understanding this are figure 5.9 (particularly, the bottom counterfactual plots) and an explanation on page 151 that coefficients of regression model shows that “species that have high neocortex percent <em>for their body mass</em> have higher milk energy” and “species with high body mass <em>for their neocortex percent</em> have lower milk energy”. In other words, if you take several species with very similar body mass, you expect those with higher percent of neocortex to have richer milk. Conversely, if you handpick several species with very similar neocortex percentage, you expect that the larger ones will have a less energetic milk. But because these two predictor variables are correlated, this relationship is easy to see only when you fix one of them. Figure 5.9 tries to show that but we can do better by (artificially) grouping the data looking at relationship between each predictor variable and the milk energy individually.</p>
<p>Let us start by replicating top subplots in figure 5.9. Note that 1) I used frequentist linear model fit with flat priors via <code>geom_smooth()</code> and, therefore, 2) the stripes correspond to standard error rather than 89% credible interval. However, the two are close enough in this case for illustration purposes.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">milk</span><span class="op">)</span>
<span class="va">milk_df</span> <span class="op">&lt;-</span> 
  <span class="va">milk</span> <span class="op">%&gt;%</span>
  <span class="co"># standardize</span>
  <span class="fu">mutate</span><span class="op">(</span>K <span class="op">=</span> <span class="fu">standardize</span><span class="op">(</span><span class="va">kcal.per.g</span><span class="op">)</span>,
         N <span class="op">=</span> <span class="fu">standardize</span><span class="op">(</span><span class="va">neocortex.perc</span><span class="op">)</span>,
         M <span class="op">=</span> <span class="fu">standardize</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">mass</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  
  <span class="co"># keep only complete cases</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">NK_plot</span> <span class="op">&lt;-</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="va">milk_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">N</span>, y<span class="op">=</span><span class="va">K</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_smooth</span><span class="op">(</span>method<span class="op">=</span><span class="st">"lm"</span>, formula<span class="op">=</span><span class="va">y</span><span class="op">~</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">xlab</span><span class="op">(</span><span class="st">"neocortex percent (std)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ylab</span><span class="op">(</span><span class="st">"kilocal per g (std)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span>

<span class="va">MK_plot</span> <span class="op">&lt;-</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="va">milk_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">M</span>, y<span class="op">=</span><span class="va">K</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_smooth</span><span class="op">(</span>method<span class="op">=</span><span class="st">"lm"</span>, formula<span class="op">=</span><span class="va">y</span><span class="op">~</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">xlab</span><span class="op">(</span><span class="st">"log body mass (std)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ylab</span><span class="op">(</span><span class="st">"kilocal per g (std)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span>

<span class="va">NK_plot</span> <span class="op">|</span> <span class="va">MK_plot</span></code></pre></div>
<div class="inline-figure"><img src="notes-on-statistical-rethinking_files/figure-html/unnamed-chunk-69-1.png" width="672"></div>
<p>So, once again, we see that there is no clear relationship is evident if we consider neocortex percent while ignoring body mass of an animal and, vice versa, when we look only at the log body mass ignoring the cortex. Let us reduce our state of ignorance by splitting individual species into three groups based on their similarity in neocortex percentage. Note that I have put no extra care into the grouping process apart from ensuring that all groups have roughly the same number of species. Also note that connecting lines have no specific meaning and I’ve added them only to make visual grouping of dots of the same color easier.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">milk_df</span> <span class="op">&lt;-</span> 
  <span class="va">milk_df</span> <span class="op">%&gt;%</span>
  <span class="co"># split data into three groups</span>
  <span class="fu">mutate</span><span class="op">(</span>`Mass group` <span class="op">=</span> <span class="fu">cut_number</span><span class="op">(</span><span class="va">M</span>, <span class="fl">3</span><span class="op">)</span>, 
         `Neocortex group` <span class="op">=</span> <span class="fu">cut_number</span><span class="op">(</span><span class="va">N</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>

<span class="va">NK_plot</span> <span class="op">&lt;-</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="va">milk_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">N</span>, y<span class="op">=</span><span class="va">K</span>, color<span class="op">=</span><span class="va">`Neocortex group`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">xlab</span><span class="op">(</span><span class="st">"neocortex percent (std)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ylab</span><span class="op">(</span><span class="st">"kilocal per g (std)"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">guides</span><span class="op">(</span>col <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span>

<span class="va">MK_plot</span> <span class="op">&lt;-</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="va">milk_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">M</span>, y<span class="op">=</span><span class="va">K</span>, color<span class="op">=</span><span class="va">`Neocortex group`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">xlab</span><span class="op">(</span><span class="st">"log body mass (std)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ylab</span><span class="op">(</span><span class="st">"kilocal per g (std)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme</span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">guides</span><span class="op">(</span>col <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span>

<span class="va">NK_plot</span> <span class="op">|</span> <span class="va">MK_plot</span></code></pre></div>
<div class="inline-figure"><img src="notes-on-statistical-rethinking_files/figure-html/unnamed-chunk-70-1.png" width="672"></div>
<p>Once we group species either by their their neocortex percent, you can immediately see the pattern. The pattern on the left is trivial as it merely shows our grouping based on low (red), medium (green), and high (blue) percentage of neocortex. However, when we look at the right plot, we see how species with similar neocortex percentage cluster nicely together and this way you can see a nice negative correlation between log body mass and milk energy <em>within each group</em>. This is because the same <em>absolute</em> log body mass corresponds to different <em>relative</em> log body mass with each group. I.e., a vertical slice through body mass leads to different values of milk energy <em>because</em> these values come from different neocortex percent groups. To summarize, we can see that log body mass is informative <em>only</em> if we know neocortex percent of an animal.</p>
<p>Let us try to visualize what multiple regression is doing. Keep in mind that this will only be a rough approximation because we will use just three means (one for each neocortex percent group), whereas our model computes an appropriate mean for every single specie. We will emulate the model check of whether “species that have <em>particular</em> neocortex percent <em>for their body mass</em> have lower milk energy” by centering each group, i.e., subtracting each groups’ mean from body mass of each specie from that group. In other words, we align each group so that average bogy mass species <em>for each group</em> are in the center, the larger species <em>within each group</em> are on the right and the smaller species <em>within each group</em> are on the left. This way we remove a positive correlation between neocortex percent and body mass and, therefore, can see the effect of the body mass on the milk energy <em>alone</em>. And, even in this approximate way the dependence in very clear.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">milk_df</span> <span class="op">&lt;-</span> 
  <span class="va">milk_df</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">`Neocortex group`</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>cM <span class="op">=</span> <span class="va">M</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="va">milk_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">cM</span>, y<span class="op">=</span><span class="va">K</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_smooth</span><span class="op">(</span>method<span class="op">=</span><span class="st">"lm"</span>, formula<span class="op">=</span><span class="va">y</span><span class="op">~</span><span class="va">x</span>, color<span class="op">=</span><span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color<span class="op">=</span><span class="va">`Neocortex group`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">xlab</span><span class="op">(</span><span class="st">"log body mass - group mean log body mass (std)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ylab</span><span class="op">(</span><span class="st">"kilocal per g (std)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme</span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"right"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">guides</span><span class="op">(</span>col <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">xlim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="notes-on-statistical-rethinking_files/figure-html/unnamed-chunk-71-1.png" width="672"></div>
<p>The plot above expresses the same idea as a counterfactual right bottom plot in figure 5.9. Where, the question was “what is the effect of log body mass for <em>all</em> species with an average neocortex percent”, so single very specific group of animals. Our plot merely extended that idea to three groups. To appreciate this the link, let us fit the model and plot same counterfactuals for each group that we identified.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m5.7</span> <span class="op">&lt;-</span> <span class="fu">quap</span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">alist</a></span><span class="op">(</span>
    <span class="va">K</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span> <span class="va">mu</span> , <span class="va">sigma</span> <span class="op">)</span> ,
    <span class="va">mu</span> <span class="op">&lt;-</span> <span class="va">a</span> <span class="op">+</span> <span class="va">bN</span><span class="op">*</span><span class="va">N</span> <span class="op">+</span> <span class="va">bM</span><span class="op">*</span><span class="va">M</span> ,
    <span class="va">a</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span> <span class="fl">0</span> , <span class="fl">0.2</span> <span class="op">)</span> ,
    <span class="va">bN</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span> <span class="fl">0</span> , <span class="fl">0.5</span> <span class="op">)</span> ,
    <span class="va">bM</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span> <span class="fl">0</span> , <span class="fl">0.5</span> <span class="op">)</span> ,
    <span class="va">sigma</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">dexp</a></span><span class="op">(</span> <span class="fl">1</span> <span class="op">)</span>
  <span class="op">)</span>,
  data<span class="op">=</span><span class="va">milk_df</span><span class="op">)</span>


<span class="co"># function to compute counterfactuals</span>
<span class="va">compute_counterfactual</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">quap_fit</span>, <span class="va">neocortex</span>, <span class="va">logmass</span><span class="op">)</span><span class="op">{</span>
  <span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu">link</span><span class="op">(</span><span class="va">quap_fit</span>, data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>N<span class="op">=</span><span class="va">neocortex</span>, M<span class="op">=</span><span class="va">logmass</span><span class="op">)</span><span class="op">)</span>
  <span class="va">mu_PI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">mu</span>,<span class="fl">2</span>,<span class="va">PI</span><span class="op">)</span>
  <span class="fu">tibble</span><span class="op">(</span>M <span class="op">=</span> <span class="va">logmass</span>,
         N <span class="op">=</span> <span class="va">neocortex</span>,
         K <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">mu</span>,<span class="fl">2</span>,<span class="va">mean</span><span class="op">)</span>,
         KLower <span class="op">=</span> <span class="va">mu_PI</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>,
         KUpper <span class="op">=</span> <span class="va">mu_PI</span><span class="op">[</span><span class="fl">2</span>, <span class="op">]</span><span class="op">)</span>
<span class="op">}</span>



<span class="co"># defining x-ticks as all milk values at regular intervals</span>
<span class="va">x_seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span> from<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">milk_df</span><span class="op">$</span><span class="va">M</span><span class="op">)</span><span class="op">-</span><span class="fl">0.15</span> , to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">milk_df</span><span class="op">$</span><span class="va">M</span><span class="op">)</span><span class="op">+</span><span class="fl">0.15</span> , length.out<span class="op">=</span><span class="fl">30</span><span class="op">)</span>

<span class="co"># mean neocortex percent for each neocortex percent group</span>
<span class="va">neocortex_counterfactuals_df</span> <span class="op">&lt;-</span>
  <span class="co"># compute average neocortex for each group</span>
  <span class="va">milk_df</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">`Neocortex group`</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>MeanPercent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, .groups<span class="op">=</span><span class="st">"keep"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  
  <span class="co"># compute counterfactual predictions for each group</span>
  <span class="fu">group_modify</span><span class="op">(</span><span class="op">~</span><span class="fu">compute_counterfactual</span><span class="op">(</span><span class="va">m5.7</span>, neocortex<span class="op">=</span><span class="va">.x</span><span class="op">$</span><span class="va">MeanPercent</span>, logmass<span class="op">=</span><span class="va">x_seq</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span>
  
<span class="co"># plotting data</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">milk_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">M</span>, y<span class="op">=</span><span class="va">K</span>, color<span class="op">=</span><span class="va">`Neocortex group`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_ribbon</span><span class="op">(</span>data<span class="op">=</span><span class="va">neocortex_counterfactuals_df</span>, <span class="fu">aes</span><span class="op">(</span>ymin<span class="op">=</span><span class="va">KLower</span>, ymax<span class="op">=</span><span class="va">KUpper</span>, fill<span class="op">=</span><span class="va">`Neocortex group`</span><span class="op">)</span>, color<span class="op">=</span><span class="cn">NA</span>, alpha<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span>data<span class="op">=</span><span class="va">neocortex_counterfactuals_df</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span>shape<span class="op">=</span><span class="fl">21</span>, fill<span class="op">=</span><span class="st">"white"</span>, size<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">xlab</span><span class="op">(</span><span class="st">"log body mass (std)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ylab</span><span class="op">(</span><span class="st">"kilocal per g (std)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">xlim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2.5</span>, <span class="fl">2.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"right"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">guides</span><span class="op">(</span>col <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="notes-on-statistical-rethinking_files/figure-html/unnamed-chunk-72-1.png" width="672"></div>
<p>And we can do this the other way around grouping species by their log body mass.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">logmass_counterfactuals_df</span> <span class="op">&lt;-</span>
  <span class="va">milk_df</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">`Mass group`</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>MeanMass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span>, .groups<span class="op">=</span><span class="st">"keep"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  
  <span class="co"># compute counterfactual predictions for each group</span>
  <span class="fu">group_modify</span><span class="op">(</span><span class="op">~</span><span class="fu">compute_counterfactual</span><span class="op">(</span><span class="va">m5.7</span>, neocortex<span class="op">=</span><span class="va">x_seq</span>, logmass<span class="op">=</span><span class="va">.x</span><span class="op">$</span><span class="va">MeanMass</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span>
  
<span class="co"># plotting data</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">milk_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">N</span>, y<span class="op">=</span><span class="va">K</span>, color<span class="op">=</span><span class="va">`Mass group`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_ribbon</span><span class="op">(</span>data<span class="op">=</span><span class="va">logmass_counterfactuals_df</span>, <span class="fu">aes</span><span class="op">(</span>ymin<span class="op">=</span><span class="va">KLower</span>, ymax<span class="op">=</span><span class="va">KUpper</span>, fill<span class="op">=</span><span class="va">`Mass group`</span><span class="op">)</span>, color<span class="op">=</span><span class="cn">NA</span>, alpha<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span>data<span class="op">=</span><span class="va">logmass_counterfactuals_df</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span>shape<span class="op">=</span><span class="fl">21</span>, fill<span class="op">=</span><span class="st">"white"</span>, size<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">xlab</span><span class="op">(</span><span class="st">"neocortex percent (std)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ylab</span><span class="op">(</span><span class="st">"kilocal per g (std)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">xlim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2.5</span>, <span class="fl">2.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"right"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">guides</span><span class="op">(</span>col <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="notes-on-statistical-rethinking_files/figure-html/unnamed-chunk-73-1.png" width="672"></div>
<div id="a-warning-message" class="section level2" number="17.1">
<h2>
<span class="header-section-number">17.1</span> A warning message<a class="anchor" aria-label="anchor" href="#a-warning-message"><i class="fas fa-link"></i></a>
</h2>
<p>Do these two examples (spriouos associations and masked relationship) mean that putting <em>all</em> variables into a model is always a good idea because “magic”? Unfortunately, no. These examples were handpicked by McElreath to show the power of multiple regression. He can also handpick an example when mindlessly throwing variables into a model would lead to a disaster, a.k.a. <a href="https://elevanth.org/blog/2021/06/15/regression-fire-and-dangerous-things-1-3/">Causal Salad</a> (watch his <a href="https://youtu.be/KNPYUVmY3NM"><strong>three hour talk</strong></a> on that on YouTube). The take home message is same as before: Models are golems, they can help you understand the process you are investigating but they won’t understand it for you! It is your job to think about causal relationship using statistical inferences merely as an aid, not as an oracle.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="effective-degrees-of-freedom-number-of-parameters.html"><span class="header-section-number">16</span> Effective degrees of freedom / number of parameters</a></div>
<div class="next"><a href="ordered-categorical-data-i.e.-likert-scales.html"><span class="header-section-number">18</span> Ordered Categorical Data, i.e., Likert-scales</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#multiple-regression---masked-relationship"><span class="header-section-number">17</span> Multiple regression - Masked relationship</a></li>
<li><a class="nav-link" href="#a-warning-message"><span class="header-section-number">17.1</span> A warning message</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/alexander-pastukhov/notes-on-statistics/blob/master/16-masked-relationship.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/alexander-pastukhov/notes-on-statistics/edit/master/16-masked-relationship.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Notes on Statistics</strong>" was written by Alexander Pastukhov. It was last built on 2022-06-05.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
