<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Multiple Regression and Causal Reasoning | Notes on and Solutions for Statistical Rethinking</title>
  <meta name="description" content="Notes and exercise solutions for Statistical Rethinking book." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Multiple Regression and Causal Reasoning | Notes on and Solutions for Statistical Rethinking" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Notes and exercise solutions for Statistical Rethinking book." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Multiple Regression and Causal Reasoning | Notes on and Solutions for Statistical Rethinking" />
  
  <meta name="twitter:description" content="Notes and exercise solutions for Statistical Rethinking book." />
  

<meta name="author" content="Alexander Pastukhov" />


<meta name="date" content="2020-12-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="loss-functions.html"/>
<link rel="next" href="solutions-for-chapter-2.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Notes on Statistical Rethinking</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Precis</a></li>
<li class="chapter" data-level="2" data-path="loss-functions.html"><a href="loss-functions.html"><i class="fa fa-check"></i><b>2</b> Loss functions</a>
<ul>
<li class="chapter" data-level="2.1" data-path="loss-functions.html"><a href="loss-functions.html#loss-function-the-concept"><i class="fa fa-check"></i><b>2.1</b> Loss function, the concept</a></li>
<li class="chapter" data-level="2.2" data-path="loss-functions.html"><a href="loss-functions.html#l0-mode"><i class="fa fa-check"></i><b>2.2</b> L0 (mode)</a></li>
<li class="chapter" data-level="2.3" data-path="loss-functions.html"><a href="loss-functions.html#l1-median"><i class="fa fa-check"></i><b>2.3</b> L1 (median)</a></li>
<li class="chapter" data-level="2.4" data-path="loss-functions.html"><a href="loss-functions.html#l2-mean"><i class="fa fa-check"></i><b>2.4</b> L2 (mean)</a></li>
<li class="chapter" data-level="2.5" data-path="loss-functions.html"><a href="loss-functions.html#l1-median-vs.-l2-mean"><i class="fa fa-check"></i><b>2.5</b> L1 (median) vs. L2 (mean)</a></li>
<li class="chapter" data-level="2.6" data-path="loss-functions.html"><a href="loss-functions.html#choosing-a-likelihood"><i class="fa fa-check"></i><b>2.6</b> Choosing a likelihood</a></li>
<li class="chapter" data-level="2.7" data-path="loss-functions.html"><a href="loss-functions.html#gaussian-in-frenquentist-versus-bayesian-statistics"><i class="fa fa-check"></i><b>2.7</b> Gaussian in frenquentist versus Bayesian statistics</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="multiple-regression-and-causal-reasoning.html"><a href="multiple-regression-and-causal-reasoning.html"><i class="fa fa-check"></i><b>3</b> Multiple Regression and Causal Reasoning</a>
<ul>
<li class="chapter" data-level="3.1" data-path="multiple-regression-and-causal-reasoning.html"><a href="multiple-regression-and-causal-reasoning.html#peering-into-a-black-box"><i class="fa fa-check"></i><b>3.1</b> Peering into a black box</a></li>
<li class="chapter" data-level="3.2" data-path="multiple-regression-and-causal-reasoning.html"><a href="multiple-regression-and-causal-reasoning.html#turning-unconditional-dependence-into-conditional-independence"><i class="fa fa-check"></i><b>3.2</b> Turning unconditional dependence into conditional independence</a></li>
<li class="chapter" data-level="3.3" data-path="multiple-regression-and-causal-reasoning.html"><a href="multiple-regression-and-causal-reasoning.html#magic-of-multiple-regression"><i class="fa fa-check"></i><b>3.3</b> Magic of multiple regression</a></li>
<li class="chapter" data-level="3.4" data-path="multiple-regression-and-causal-reasoning.html"><a href="multiple-regression-and-causal-reasoning.html#multicollinearity"><i class="fa fa-check"></i><b>3.4</b> Multicollinearity</a></li>
<li class="chapter" data-level="3.5" data-path="multiple-regression-and-causal-reasoning.html"><a href="multiple-regression-and-causal-reasoning.html#back-to-spurious-association"><i class="fa fa-check"></i><b>3.5</b> Back to spurious association</a></li>
<li class="chapter" data-level="3.6" data-path="multiple-regression-and-causal-reasoning.html"><a href="multiple-regression-and-causal-reasoning.html#warning"><i class="fa fa-check"></i><b>3.6</b> Warning</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="solutions-for-chapter-2.html"><a href="solutions-for-chapter-2.html"><i class="fa fa-check"></i><b>4</b> Solutions for Chapter 2</a></li>
<li class="chapter" data-level="5" data-path="solutions-for-chapter-3.html"><a href="solutions-for-chapter-3.html"><i class="fa fa-check"></i><b>5</b> Solutions for Chapter 3</a></li>
<li class="chapter" data-level="6" data-path="solutions-for-chapter-4.html"><a href="solutions-for-chapter-4.html"><i class="fa fa-check"></i><b>6</b> Solutions for Chapter 4</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Notes on and Solutions for Statistical Rethinking</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="multiple-regression-and-causal-reasoning" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Multiple Regression and Causal Reasoning</h1>
<p>This notes are on Chapter 5 “The Many Variables &amp; The Spurious Waffles,” specifically, on section 5.1 “Spurious association.” If you are to remember one thing from that chapter, it should be “doing multiple regression is easy, understanding and interpreting it is hard.”</p>
<div id="peering-into-a-black-box" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Peering into a black box</h2>
<p>To better understand the relationship between data and statistical analysis on the one hand and DAGs (directed acyclic graphs) on the other hand, I came up with an electric engineering metaphor<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>. Imagine that you have an electric device that you cannot take apart. However, there are certain points where you can connect your multimeter and check whether current flows between these two points. You also have a schematics for the device but you have no idea whether it is accurate. The names of the connector nodes match but <em>the connectivity</em> between them is anybody’s guess. So, what do you do? You look at the schematics and identify two nodes where current should <em>definitely flow</em> and you measure whether that is the case. Do you have signal? Good, that means that <em>at least with respect to the connectivity between these two nodes</em> you schematics is not completely wrong. No signal? Sorry, your schematics is no good, find a different one or try making one yourself. Conversely, you can identify two nodes, so that <em>no current</em> should flow between them and measure it <em>empirically</em>. No current? Good! Current? Bad, your schematics is wrong.</p>
<p>The relationship between the device and the schematics is that of the large (device) and small (schematics) world. Your job is to iteratively adjust the latter, so that it matches the former. You need to keep prodding the black box until predictions from your schematics start matching the actual readings. Only then you can say that you understand how device works and you can make predictions about what it will do under different conditions. Although testing based on schematics can be automated, generating such schematics is a creating process. It depends on our knowledge about devices of that kind and about individual exposed nodes.</p>
<p>Hopefully, you can see how it maps on our observational or experimental data (large world, readings from the device) and DAGs (small world, presumed schematics). As a scientist, you <em>guess</em><a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a> the causal relationships between individual variables and you draw a schematics for that (a DAG). Using this DAG, you identify pairs of variables that must be dependent or independent <em>assuming your DAG is correct</em> and check the data on whether this is indeed the case. It is? Good, your DAG is not (entirely) wrong! They are not? Bad news, their causal relationship is different from what you (or others in prior work) came up with. You need to modify DAG or draw a completely different one, just like a engineer must modify the schematics.</p>
<p>Note that this process is the opposite to that in a typical multivariate analysis approach using, say, ANOVA. In the latter case, you throw <em>everything</em> together, including some/all interactions between the terms, and try figuring out causal relationship between individual independent and the dependent variable based on magnitude and significance of individual terms. So, <em>first</em> you run the statistical analysis and <em>then</em> you make your inferences about causal relationships. In causal reasoning using DAG, you <em>first</em> formulate causal relationships and <em>then</em> you use statistical analysis to check whether these relationship are correct. The second approach is much more powerful, because you can run ANOVA only once but you can formulate many DAGs that describe your data and test them iteratively, refining your understanding step-by-step. Moreover, ANOVA (or any other regression model like that) is about identifying relationships between invididual independent and the signle dependent variable (individual coefficients tell you how independent variables can be used to predict the dependent). DAG-based analysis allows you to predict and test relationship between pairs of <em>dependent</em> variables as well, decomposing your complex model into <em>testable</em> and <em>verifyable</em> chunks. It is a more involved and time-consuming approach but it gives you much deeper understanding of the process you are styding compared to “throw everything into ANOVA and hope it will magically figure it out.”</p>
<p>Moreover, causal calculus via DAGs has another trick up its sleeve. You can use <em>conditional probabilities</em> (see below) to flip the relationship between variables. If two variables are independent, they may be dependent when conditioned on some third variable. Or vice versa, depedent variables can become <em>conditionally independent</em>. This means that your predictions about connectivity between pairs of variables can be both more specific (e.g., they are related via a third variable or they both independently cause that third variable) and more testable, as you now have two <em>opposite</em> predictions for the same pair of variables! You can check that current flows when it should (unconditional probability) and <em>does not flow</em> once you condition it on the third variable. Both tests match? DAG is not that bad! One or none match? Back to the drawing board!</p>
</div>
<div id="turning-unconditional-dependence-into-conditional-independence" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Turning unconditional dependence into conditional independence</h2>
<p>Below, you will see how multiple regression can show conditional independence of two variable in case of the fork DAG in divorce data. However, there is another more general way to understand this concept it terms of conditional probabilities <span class="math inline">\(Pr(M|A)\)</span> and <span class="math inline">\(Pr(D|A)\)</span>. For this, it helps to understand condition probabilities as <em>filtering</em> operation. When we compute conditional probability for a <em>specific</em> value of <span class="math inline">\(A\)</span>, this means that we slice the data, keeping only whose values of <span class="math inline">\(M\)</span> and <span class="math inline">\(D\)</span> that correspond to that chosen level of <span class="math inline">\(A\)</span>. It is easier to understand, if we visualize that conditional-probability-as-filtering in synthetic data. For illustration purposes, I will synthesize divorce data, keeping the relationships but I will space marriage age linearly and generate the data so that there are 20 data points for each age (makes it easier to see and understand).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="multiple-regression-and-causal-reasoning.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">84321169</span>)</span>
<span id="cb1-2"><a href="multiple-regression-and-causal-reasoning.html#cb1-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">180</span></span>
<span id="cb1-3"><a href="multiple-regression-and-causal-reasoning.html#cb1-3" aria-hidden="true" tabindex="-1"></a>sigma_noise <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb1-4"><a href="multiple-regression-and-causal-reasoning.html#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># we repeat each value of age 10 times to make filtering operation easier to see</span></span>
<span id="cb1-5"><a href="multiple-regression-and-causal-reasoning.html#cb1-5" aria-hidden="true" tabindex="-1"></a>sim_waffles <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">MedianAgeMarriage =</span> <span class="fu">rep</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="at">length.out=</span><span class="dv">9</span>), <span class="dv">20</span>), </span>
<span id="cb1-6"><a href="multiple-regression-and-causal-reasoning.html#cb1-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Divorce =</span> <span class="fu">rnorm</span>(N, MedianAgeMarriage, sigma_noise),</span>
<span id="cb1-7"><a href="multiple-regression-and-causal-reasoning.html#cb1-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Marriage =</span> <span class="sc">-</span><span class="fu">rnorm</span>(N, MedianAgeMarriage, sigma_noise))</span>
<span id="cb1-8"><a href="multiple-regression-and-causal-reasoning.html#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="multiple-regression-and-causal-reasoning.html#cb1-9" aria-hidden="true" tabindex="-1"></a>MD_plot <span class="ot">&lt;-</span> </span>
<span id="cb1-10"><a href="multiple-regression-and-causal-reasoning.html#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data=</span>sim_waffles, <span class="fu">aes</span>(<span class="at">x=</span>Marriage, <span class="at">y=</span>Divorce)) <span class="sc">+</span> </span>
<span id="cb1-11"><a href="multiple-regression-and-causal-reasoning.html#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>, <span class="at">formula=</span>y<span class="sc">~</span>x) <span class="sc">+</span> </span>
<span id="cb1-12"><a href="multiple-regression-and-causal-reasoning.html#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb1-13"><a href="multiple-regression-and-causal-reasoning.html#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Marriage rate&quot;</span>) <span class="sc">+</span> </span>
<span id="cb1-14"><a href="multiple-regression-and-causal-reasoning.html#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Divorce rate&quot;</span>)</span>
<span id="cb1-15"><a href="multiple-regression-and-causal-reasoning.html#cb1-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-16"><a href="multiple-regression-and-causal-reasoning.html#cb1-16" aria-hidden="true" tabindex="-1"></a>AD_plot <span class="ot">&lt;-</span> </span>
<span id="cb1-17"><a href="multiple-regression-and-causal-reasoning.html#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data=</span>sim_waffles, <span class="fu">aes</span>(<span class="at">x=</span>MedianAgeMarriage, <span class="at">y=</span>Divorce)) <span class="sc">+</span> </span>
<span id="cb1-18"><a href="multiple-regression-and-causal-reasoning.html#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>, <span class="at">formula=</span>y<span class="sc">~</span>x) <span class="sc">+</span> </span>
<span id="cb1-19"><a href="multiple-regression-and-causal-reasoning.html#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb1-20"><a href="multiple-regression-and-causal-reasoning.html#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Median age marriage&quot;</span>) <span class="sc">+</span> </span>
<span id="cb1-21"><a href="multiple-regression-and-causal-reasoning.html#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Divorce rate&quot;</span>)</span>
<span id="cb1-22"><a href="multiple-regression-and-causal-reasoning.html#cb1-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-23"><a href="multiple-regression-and-causal-reasoning.html#cb1-23" aria-hidden="true" tabindex="-1"></a>AM_plot <span class="ot">&lt;-</span> </span>
<span id="cb1-24"><a href="multiple-regression-and-causal-reasoning.html#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data=</span>sim_waffles, <span class="fu">aes</span>(<span class="at">x=</span>MedianAgeMarriage, <span class="at">y=</span>Marriage)) <span class="sc">+</span> </span>
<span id="cb1-25"><a href="multiple-regression-and-causal-reasoning.html#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>, <span class="at">formula=</span>y<span class="sc">~</span>x) <span class="sc">+</span> </span>
<span id="cb1-26"><a href="multiple-regression-and-causal-reasoning.html#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb1-27"><a href="multiple-regression-and-causal-reasoning.html#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Median age marriage&quot;</span>) <span class="sc">+</span> </span>
<span id="cb1-28"><a href="multiple-regression-and-causal-reasoning.html#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Marriage rate&quot;</span>)</span>
<span id="cb1-29"><a href="multiple-regression-and-causal-reasoning.html#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="multiple-regression-and-causal-reasoning.html#cb1-30" aria-hidden="true" tabindex="-1"></a>MD_plot <span class="sc">|</span> AD_plot <span class="sc">|</span> AM_plot</span></code></pre></div>
<p><img src="notes-on-statistical-rethinking_files/figure-html/unnamed-chunk-11-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>As you can see, all variables being dependent on each other, as in case of the original data. However, let us pick an arbitrary value, say <span class="math inline">\(A=1\)</span><a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a> and see which dots on the left plot will be selected via <em>filtering</em> on that value.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="multiple-regression-and-causal-reasoning.html#cb2-1" aria-hidden="true" tabindex="-1"></a>MD_plot <span class="ot">&lt;-</span> </span>
<span id="cb2-2"><a href="multiple-regression-and-causal-reasoning.html#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data=</span>sim_waffles, <span class="fu">aes</span>(<span class="at">x=</span>Marriage, <span class="at">y=</span>Divorce)) <span class="sc">+</span> </span>
<span id="cb2-3"><a href="multiple-regression-and-causal-reasoning.html#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>, <span class="at">formula=</span>y<span class="sc">~</span>x, <span class="at">alpha=</span><span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb2-4"><a href="multiple-regression-and-causal-reasoning.html#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data=</span>sim_waffles <span class="sc">%&gt;%</span> <span class="fu">filter</span>(MedianAgeMarriage <span class="sc">==</span> <span class="dv">1</span>), <span class="at">color=</span><span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb2-5"><a href="multiple-regression-and-causal-reasoning.html#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data=</span>sim_waffles <span class="sc">%&gt;%</span> <span class="fu">filter</span>(MedianAgeMarriage <span class="sc">!=</span> <span class="dv">1</span>), <span class="at">alpha=</span><span class="fl">0.15</span>) <span class="sc">+</span> </span>
<span id="cb2-6"><a href="multiple-regression-and-causal-reasoning.html#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Marriage rate&quot;</span>) <span class="sc">+</span> </span>
<span id="cb2-7"><a href="multiple-regression-and-causal-reasoning.html#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Divorce rate&quot;</span>) </span>
<span id="cb2-8"><a href="multiple-regression-and-causal-reasoning.html#cb2-8" aria-hidden="true" tabindex="-1"></a>AD_plot <span class="ot">&lt;-</span> </span>
<span id="cb2-9"><a href="multiple-regression-and-causal-reasoning.html#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data=</span>sim_waffles, <span class="fu">aes</span>(<span class="at">x=</span>MedianAgeMarriage, <span class="at">y=</span>Divorce)) <span class="sc">+</span> </span>
<span id="cb2-10"><a href="multiple-regression-and-causal-reasoning.html#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>, <span class="at">formula=</span>y<span class="sc">~</span>x) <span class="sc">+</span> </span>
<span id="cb2-11"><a href="multiple-regression-and-causal-reasoning.html#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data=</span>sim_waffles <span class="sc">%&gt;%</span> <span class="fu">filter</span>(MedianAgeMarriage <span class="sc">==</span> <span class="dv">1</span>), <span class="at">color=</span><span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb2-12"><a href="multiple-regression-and-causal-reasoning.html#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data=</span>sim_waffles <span class="sc">%&gt;%</span> <span class="fu">filter</span>(MedianAgeMarriage <span class="sc">!=</span> <span class="dv">1</span>), <span class="at">alpha=</span><span class="fl">0.15</span>) <span class="sc">+</span> </span>
<span id="cb2-13"><a href="multiple-regression-and-causal-reasoning.html#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Median age marriage&quot;</span>) <span class="sc">+</span> </span>
<span id="cb2-14"><a href="multiple-regression-and-causal-reasoning.html#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Divorce rate&quot;</span>)</span>
<span id="cb2-15"><a href="multiple-regression-and-causal-reasoning.html#cb2-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-16"><a href="multiple-regression-and-causal-reasoning.html#cb2-16" aria-hidden="true" tabindex="-1"></a>AM_plot <span class="ot">&lt;-</span></span>
<span id="cb2-17"><a href="multiple-regression-and-causal-reasoning.html#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data=</span>sim_waffles, <span class="fu">aes</span>(<span class="at">x=</span>Marriage, <span class="at">y=</span>MedianAgeMarriage)) <span class="sc">+</span> </span>
<span id="cb2-18"><a href="multiple-regression-and-causal-reasoning.html#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>, <span class="at">formula=</span>y<span class="sc">~</span>x) <span class="sc">+</span> </span>
<span id="cb2-19"><a href="multiple-regression-and-causal-reasoning.html#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data=</span>sim_waffles <span class="sc">%&gt;%</span> <span class="fu">filter</span>(MedianAgeMarriage <span class="sc">==</span> <span class="dv">1</span>), <span class="at">color=</span><span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb2-20"><a href="multiple-regression-and-causal-reasoning.html#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data=</span>sim_waffles <span class="sc">%&gt;%</span> <span class="fu">filter</span>(MedianAgeMarriage <span class="sc">!=</span> <span class="dv">1</span>), <span class="at">alpha=</span><span class="fl">0.15</span>) <span class="sc">+</span> </span>
<span id="cb2-21"><a href="multiple-regression-and-causal-reasoning.html#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Median age marriage&quot;</span>) <span class="sc">+</span> </span>
<span id="cb2-22"><a href="multiple-regression-and-causal-reasoning.html#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Marriage rate&quot;</span>) </span>
<span id="cb2-23"><a href="multiple-regression-and-causal-reasoning.html#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="multiple-regression-and-causal-reasoning.html#cb2-24" aria-hidden="true" tabindex="-1"></a>MD_A1_plot <span class="ot">&lt;-</span> </span>
<span id="cb2-25"><a href="multiple-regression-and-causal-reasoning.html#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data=</span>sim_waffles <span class="sc">%&gt;%</span> <span class="fu">filter</span>(MedianAgeMarriage <span class="sc">==</span> <span class="dv">1</span>), </span>
<span id="cb2-26"><a href="multiple-regression-and-causal-reasoning.html#cb2-26" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(<span class="at">x=</span>Marriage, <span class="at">y=</span>Divorce)) <span class="sc">+</span> </span>
<span id="cb2-27"><a href="multiple-regression-and-causal-reasoning.html#cb2-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>, <span class="at">formula=</span>y<span class="sc">~</span>x, <span class="at">color=</span><span class="st">&quot;red&quot;</span>) <span class="sc">+</span> </span>
<span id="cb2-28"><a href="multiple-regression-and-causal-reasoning.html#cb2-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb2-29"><a href="multiple-regression-and-causal-reasoning.html#cb2-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Marriage rate&quot;</span>) <span class="sc">+</span> </span>
<span id="cb2-30"><a href="multiple-regression-and-causal-reasoning.html#cb2-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Divorce rate&quot;</span>) <span class="sc">+</span></span>
<span id="cb2-31"><a href="multiple-regression-and-causal-reasoning.html#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Pr( |Mariage Age = 1)&quot;</span>)</span>
<span id="cb2-32"><a href="multiple-regression-and-causal-reasoning.html#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="multiple-regression-and-causal-reasoning.html#cb2-33" aria-hidden="true" tabindex="-1"></a>(AD_plot <span class="sc">|</span> MD_plot) <span class="sc">/</span></span>
<span id="cb2-34"><a href="multiple-regression-and-causal-reasoning.html#cb2-34" aria-hidden="true" tabindex="-1"></a>(MD_A1_plot <span class="sc">|</span>AM_plot)</span></code></pre></div>
<p><img src="notes-on-statistical-rethinking_files/figure-html/unnamed-chunk-12-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>First, take at top-left and bottom-right plots that plot, correspondingly, divorce and marriage rate versus marriage age. Note that I’ve flipped axes on the bottom-right plot, so that marriage rate is always mapped on x-axis. The <em>red</em> dots in each plot correspond to divorce and marriage rates <em>given that</em> (filtered on) marriage age is 1. The same dots are marked in red in the top-right plot and are plotted separately at the bottom-right. As you can see, the two variables <em>conditional on A=1</em> are uncorrelated. Why? Because both were fully determined by marriage age and any variation (the spread of red dots vertically or horizontally in the top-left and bottom-right plots) was due to noise. Therefore, the plot on the bottom-left effectively plots noise in marriage rate versus noise in divorce rate and, by our synthetic data design, the noise in two variable was independent, hence, lack of correlation.</p>
<p>This opportunity to turn dependence into independence by conditioning two variables on the third is at the heart of causal reasoning<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>. You draw a DAG and if it has a fork in it, you know that <em>given your educated guess about causal relationship is correct</em> (small world!), your data (large world!) should show dependence <em>and</em> conditional independence of the two variables (divorce and marriage rates). What if it does not? E.g., the two variables are always dependent or always independent, conditional or not? As we already discussed above, that just means that your educated guess was wrong and that relationship of the variables is different from how you thought it is. Thus, you need to go back to the drawing board, come up with another DAG, repeat the analysis and see if that new DAG is supported by data. If you have more variables, your DAGs will be more complex but the beauty of such causal reasoning is that you can concentrate on <em>parts</em> of it, picking three variables and seeing whether your guess about these three variables was correct. This way, you can tinker with your causal model part-by-part, instead of hoping that you got <em>everything</em> right on the very first attempt.</p>
</div>
<div id="magic-of-multiple-regression" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Magic of multiple regression</h2>
<p>When reading section 5.1 “Spurious association,” I found relationships between the <em>marriage age</em>, <em>marriage rate</em>, and <em>divorce rate</em> to be both clear and mysterious. On the one hand, everything is correlated with everything.
<img src="notes-on-statistical-rethinking_files/figure-html/unnamed-chunk-13-1.png" width="100%" style="display: block; margin: auto;" />
On the other hand, once we fit linear model to predict divorce rate based on both median age marriage and marriage rate, the latter is <em>clearly</em> irrelevant (output of code 5.11 shows that its coefficient is effectively zero, meaning that it is ignored) and, therefore, it has no causal influence on divorce rate.</p>
<p>If you are like me<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a>, you said “Huh! But how does the model know that?” And, at least for me, explanations in the chapter did not help much. The key figure is 5.4, that shows that (omitting intercept and slope symbols) <code>median age marriage = marriage rate + *extra information*</code> but <code>marriage rate = median age marriage</code>. In a nutshell, both variables code the same information but there is <em>more</em> of it in median age than in marriage rate, so the latter is ignored. Unfortunately, the answer “but how?” still stands. The figure 5.4, which shows fits on residuals is illustrative, but we do not fit residuals, we fit both variables at the same time <em>without</em> fitting them on each other! Nowhere in the model 5.1.4 do we find
<span class="math display">\[\mu^{M}_{i} = \alpha_{AM} + \beta_{AM} * A_i\]</span></p>
<p>So, what’s going on? <em>How does it know?</em> To understand this, let us start with an issue of <em>multicollinearity</em>.</p>
</div>
<div id="multicollinearity" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Multicollinearity</h2>
<p>To make things easier to understand, let us use simulated data. Imagine that both marriage and divorce rate are almost perfectly linearly dependent on marriage rate, so that <span class="math inline">\(D_i = \beta_A^{true} \cdot A_i\)</span> and <span class="math inline">\(M_i = -A_i\)</span>. For the sake of simplicity <span class="math inline">\(\beta_A^{true} = 1\)</span>. We pretend our variables are already standardized, so the plots would look something like this.
<img src="notes-on-statistical-rethinking_files/figure-html/unnamed-chunk-14-1.png" width="100%" style="display: block; margin: auto;" />
The relationship is the same as in the plots above but, as we assumed an almost perfect correlation, there is not much spread around the line. Still, by definition of how we constructed the data, both marriage and divorce rate are <em>caused</em> (computed from) median age and marriage rate is never used to compute the divorce rate. What happens if we analyze this simulated data using the same model 5.1.3, will it be able to figure “marriage rate does not matter” again?</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="multiple-regression-and-causal-reasoning.html#cb3-1" aria-hidden="true" tabindex="-1"></a>sim_waffles <span class="ot">&lt;-</span></span>
<span id="cb3-2"><a href="multiple-regression-and-causal-reasoning.html#cb3-2" aria-hidden="true" tabindex="-1"></a>  sim_waffles <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="multiple-regression-and-causal-reasoning.html#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">A =</span> MedianAgeMarriage,</span>
<span id="cb3-4"><a href="multiple-regression-and-causal-reasoning.html#cb3-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">M =</span> Marriage,</span>
<span id="cb3-5"><a href="multiple-regression-and-causal-reasoning.html#cb3-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">D =</span> Divorce)</span>
<span id="cb3-6"><a href="multiple-regression-and-causal-reasoning.html#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="multiple-regression-and-causal-reasoning.html#cb3-7" aria-hidden="true" tabindex="-1"></a>sim_waffles_fit <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb3-8"><a href="multiple-regression-and-causal-reasoning.html#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb3-9"><a href="multiple-regression-and-causal-reasoning.html#cb3-9" aria-hidden="true" tabindex="-1"></a>    D <span class="sc">~</span> <span class="fu">dnorm</span>(mu , sigma) ,</span>
<span id="cb3-10"><a href="multiple-regression-and-causal-reasoning.html#cb3-10" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a <span class="sc">+</span> bM<span class="sc">*</span>M <span class="sc">+</span> bA<span class="sc">*</span>A,</span>
<span id="cb3-11"><a href="multiple-regression-and-causal-reasoning.html#cb3-11" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb3-12"><a href="multiple-regression-and-causal-reasoning.html#cb3-12" aria-hidden="true" tabindex="-1"></a>    bA <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb3-13"><a href="multiple-regression-and-causal-reasoning.html#cb3-13" aria-hidden="true" tabindex="-1"></a>    bM <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb3-14"><a href="multiple-regression-and-causal-reasoning.html#cb3-14" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb3-15"><a href="multiple-regression-and-causal-reasoning.html#cb3-15" aria-hidden="true" tabindex="-1"></a>  ), </span>
<span id="cb3-16"><a href="multiple-regression-and-causal-reasoning.html#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> sim_waffles,</span>
<span id="cb3-17"><a href="multiple-regression-and-causal-reasoning.html#cb3-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-18"><a href="multiple-regression-and-causal-reasoning.html#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="multiple-regression-and-causal-reasoning.html#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(sim_waffles_fit)</span></code></pre></div>
<pre><code>##               mean          sd        5.5%      94.5%
## a     -0.002040905 0.012914885 -0.02268138 0.01859958
## bA    -0.271365691 1.189014206 -2.17164004 1.62890866
## bM    -1.249741284 1.187251535 -3.14719854 0.64771597
## sigma  0.090132561 0.008997396  0.07575298 0.10451214</code></pre>
<p>Oh no, we broke it! <span class="math inline">\(\beta_M\)</span> is now about <code>-1.25</code> rather than zero and <span class="math inline">\(\beta_A\)</span> is around <code>-0.27</code> rather than one, as it should. Also note the uncertainty associated with both values, as they both totally overlap with zero<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a>. So, the data generation process is the same (<code>Divorce rate ← Age → Marriage rate</code>) and the model is the same (prior changes have no particular impact in this case) but the “magic” of inferring the lack of <code>Divorce rate  → Marriage rate</code> is gone! The <em>only</em> difference between the two data sets is extra variance (noise) in marriage rate variable, so let us see how the absence of that extra noise in simulated data breaks the magic.</p>
<p>When two variables, marriage age and rate in our case, are (almost) perfectly correlated, that means that you can substitute one for another. Thus, when we write<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a>
<span class="math display">\[D = \beta_A \cdot A + \beta_M \cdot M\]</span>
because <code>M = -A</code> (that’s how we generated the data!), we can substitute <code>-A</code> for <code>M</code>
<span class="math display">\[D = \beta_A \cdot A - \beta_M \cdot A \\
D = (\beta_A - \beta_M) \cdot A
D = \beta_A^{true} \cdot A
\]</span>
where
<span class="math display">\[ \beta_A^{true} = (\beta_A - \beta_M)
\]</span></p>
<p>That last bit is the curse of multicollinearity, because if two variable have <em>the same</em> information, you are, effectively, fitting their <em>sum</em>! This is equivalent to fitting the sum<a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a> of coefficients times one of the variables (does not matter which one, since they are identical, we used <code>A</code> but could have used <code>M</code>). If you look at the precis output above, you will see exactly that! <code>bA = -0.27</code> and <code>bM = -1.25</code>, so plugging them in gives us
<span class="math display">\[ \beta_A^{true} = (\beta_A - \beta_M) = (-0.27 - (-1.25)) = 0.98\]</span></p>
<p>Hey, that is the slope that we used to construct divorce rate, so fitting does work! But what about uncertainty for <em>individual</em> slopes? It stems directly from the fact that <span class="math inline">\(\beta_A^{true} = (\beta_A - \beta_M) = 1\)</span> (it is <code>1</code> just in our case, of course), as there are infinite number of pairs of numbers whose difference would give 1: <code>2-1</code>, <code>3-2</code>, <code>(-200)-(-201)</code>, <code>1000.41-999.41</code>, etc. All of them add up (subtract to) one, so the fitting procedure cannot settle on any specific region for each parameter and any specific pair of values. Any number will do, as long as the <em>other one</em> differs by one. This phenomenon of <em>masked relationship</em> is the focus of section 5.2, so you will learn more about it soon.</p>
</div>
<div id="back-to-spurious-association" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Back to spurious association</h2>
<p>Above, you have learned that if two variable have the same information, you can only fit <em>both</em> of them but cannot get individual slopes. But wasn’t that the case for real data we started with? Marriage age and rate <em>are</em> correlated, so why fitting used one (age) and not their sum? The answer is <em>extra noise</em> in marriage rate. In the real data marriage rate is age <em>plus some noise</em>: <span class="math inline">\(M = -(A + \epsilon)\)</span>, where <span class="math inline">\(\epsilon\)</span> is traditionally used to denote “some noise.” How does that change our linear model for divorce rate?
<span class="math display">\[
D = \beta_A \cdot A - \beta_M \cdot A \\
D = \beta_A \cdot A - \beta_M (A + \epsilon) \\
D = (\beta_A  - \beta_M ) \cdot A - \beta_M \cdot \epsilon
\]</span></p>
<p>By definition, <span class="math inline">\(\epsilon\)</span> is <em>pure noise</em> and has zero predictive value with respect to divorce rate. This, if we would fit it <em>alone</em>, we would expect to get a slope near zero (that is your “no significant relationship”).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="multiple-regression-and-causal-reasoning.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1231455</span>)</span>
<span id="cb5-2"><a href="multiple-regression-and-causal-reasoning.html#cb5-2" aria-hidden="true" tabindex="-1"></a>sim_waffles <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">MedianAgeMarriage =</span> <span class="fu">rnorm</span>(N),</span>
<span id="cb5-3"><a href="multiple-regression-and-causal-reasoning.html#cb5-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Divorce =</span> <span class="fu">rnorm</span>(N, MedianAgeMarriage, <span class="fl">0.1</span>),</span>
<span id="cb5-4"><a href="multiple-regression-and-causal-reasoning.html#cb5-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Marriage =</span> <span class="sc">-</span><span class="fu">rnorm</span>(N, MedianAgeMarriage, <span class="fl">0.01</span>),</span>
<span id="cb5-5"><a href="multiple-regression-and-causal-reasoning.html#cb5-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">epsilon =</span> <span class="fu">rnorm</span>(N))</span>
<span id="cb5-6"><a href="multiple-regression-and-causal-reasoning.html#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="multiple-regression-and-causal-reasoning.html#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sim_waffles, <span class="fu">aes</span>(<span class="at">x=</span>epsilon, <span class="at">y=</span>Divorce)) <span class="sc">+</span> </span>
<span id="cb5-8"><a href="multiple-regression-and-causal-reasoning.html#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>, <span class="at">formula=</span>y<span class="sc">~</span>x) <span class="sc">+</span> </span>
<span id="cb5-9"><a href="multiple-regression-and-causal-reasoning.html#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb5-10"><a href="multiple-regression-and-causal-reasoning.html#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="fu">expression</span>(epsilon)) <span class="sc">+</span> </span>
<span id="cb5-11"><a href="multiple-regression-and-causal-reasoning.html#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Marriage rate&quot;</span>)</span></code></pre></div>
<p><img src="notes-on-statistical-rethinking_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>But we are not fitting it alone, as the coefficient <span class="math inline">\(\beta_M\)</span> appears at <em>twice</em>:
<span class="math display">\[D = (\beta_A  - \beta_M) \cdot A - \beta_M \cdot \epsilon\]</span>
The latter part, <span class="math inline">\(\beta_M \cdot \epsilon\)</span>, pushes <span class="math inline">\(\beta_M\)</span> towards zero (model ignores pure noise by assigning slope of zero). But the former part, <span class="math inline">\((\beta_A - \beta_M)\)</span> only needs to add up to <span class="math inline">\(\beta_A^{true}\)</span>, so however we fix <span class="math inline">\(\beta_M\)</span>, <span class="math inline">\(\beta_A\)</span> can accommodate. Thus the closer <span class="math inline">\(\beta_M\)</span> to zero, the closer is <span class="math inline">\(\beta_A\)</span> to <span class="math inline">\(\beta_A^{true}\)</span>. And that’s how the magic works! If one variable is other variable plus noise, that <em>plus noise</em> induces extra penalty and the only way to reduce residuals is to ignore the noise by setting the slope to zero. Therefore, you ignore the variable as well, because it is merely a noisy twin of a better variable. You can see how added noise “disambiguates” the causal relationship<a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="multiple-regression-and-causal-reasoning.html#cb6-1" aria-hidden="true" tabindex="-1"></a>simulate_waffles <span class="ot">&lt;-</span> <span class="cf">function</span>(sigma_noise){</span>
<span id="cb6-2"><a href="multiple-regression-and-causal-reasoning.html#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate same data but for noise in Marraige from Age relationship</span></span>
<span id="cb6-3"><a href="multiple-regression-and-causal-reasoning.html#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">169084</span>)</span>
<span id="cb6-4"><a href="multiple-regression-and-causal-reasoning.html#cb6-4" aria-hidden="true" tabindex="-1"></a>  sim_df <span class="ot">&lt;-</span> sim_waffles <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">MedianAgeMarriage =</span> <span class="fu">rnorm</span>(N),</span>
<span id="cb6-5"><a href="multiple-regression-and-causal-reasoning.html#cb6-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">Divorce =</span> <span class="fu">rnorm</span>(N, MedianAgeMarriage, <span class="fl">0.1</span>),</span>
<span id="cb6-6"><a href="multiple-regression-and-causal-reasoning.html#cb6-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">Marriage =</span> <span class="sc">-</span><span class="fu">rnorm</span>(N, MedianAgeMarriage, sigma_noise))</span>
<span id="cb6-7"><a href="multiple-regression-and-causal-reasoning.html#cb6-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-8"><a href="multiple-regression-and-causal-reasoning.html#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fit data using OLS and pulling out two slope coefficients</span></span>
<span id="cb6-9"><a href="multiple-regression-and-causal-reasoning.html#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(Divorce <span class="sc">~</span> Marriage <span class="sc">+</span> MedianAgeMarriage, <span class="at">data=</span>sim_df) <span class="sc">%&gt;%</span> </span>
<span id="cb6-10"><a href="multiple-regression-and-causal-reasoning.html#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-11"><a href="multiple-regression-and-causal-reasoning.html#cb6-11" aria-hidden="true" tabindex="-1"></a>    .<span class="sc">$</span>coefficients <span class="sc">%&gt;%</span></span>
<span id="cb6-12"><a href="multiple-regression-and-causal-reasoning.html#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-13"><a href="multiple-regression-and-causal-reasoning.html#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="st">&quot;Variable&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-14"><a href="multiple-regression-and-causal-reasoning.html#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="sc">-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-15"><a href="multiple-regression-and-causal-reasoning.html#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">LowerCI =</span> Estimate <span class="sc">-</span> Std..Error,</span>
<span id="cb6-16"><a href="multiple-regression-and-causal-reasoning.html#cb6-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">UpperCI =</span> Estimate <span class="sc">+</span> Std..Error) <span class="sc">%&gt;%</span></span>
<span id="cb6-17"><a href="multiple-regression-and-causal-reasoning.html#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Variable, Estimate, LowerCI, UpperCI)</span>
<span id="cb6-18"><a href="multiple-regression-and-causal-reasoning.html#cb6-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-19"><a href="multiple-regression-and-causal-reasoning.html#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="multiple-regression-and-causal-reasoning.html#cb6-20" aria-hidden="true" tabindex="-1"></a>simulated_noise <span class="ot">&lt;-</span> </span>
<span id="cb6-21"><a href="multiple-regression-and-causal-reasoning.html#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">epsilon =</span><span class="fu">exp</span>(<span class="fu">seq</span>(<span class="fu">log</span>(<span class="fl">0.001</span>), <span class="fu">log</span>(<span class="fl">0.3</span>), <span class="at">length.out =</span> <span class="dv">100</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb6-22"><a href="multiple-regression-and-causal-reasoning.html#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(epsilon) <span class="sc">%&gt;%</span></span>
<span id="cb6-23"><a href="multiple-regression-and-causal-reasoning.html#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do</span>(<span class="fu">simulate_waffles</span>(.<span class="sc">$</span>epsilon))</span>
<span id="cb6-24"><a href="multiple-regression-and-causal-reasoning.html#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="multiple-regression-and-causal-reasoning.html#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(simulated_noise, <span class="fu">aes</span>(<span class="at">x=</span>epsilon, <span class="at">y=</span>Estimate)) <span class="sc">+</span> </span>
<span id="cb6-26"><a href="multiple-regression-and-causal-reasoning.html#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>LowerCI, <span class="at">ymax=</span>UpperCI, <span class="at">fill=</span>Variable), <span class="at">alpha=</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb6-27"><a href="multiple-regression-and-causal-reasoning.html#cb6-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color=</span>Variable)) <span class="sc">+</span> </span>
<span id="cb6-28"><a href="multiple-regression-and-causal-reasoning.html#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">name=</span><span class="fu">expression</span>(epsilon)) <span class="sc">+</span> </span>
<span id="cb6-29"><a href="multiple-regression-and-causal-reasoning.html#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Slope estimate  ± standard error&quot;</span>) <span class="sc">+</span></span>
<span id="cb6-30"><a href="multiple-regression-and-causal-reasoning.html#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Marriage = MedianAgeMarriage + Normal(0, &quot;</span>, epsilon, <span class="st">&quot;)&quot;</span>)))</span></code></pre></div>
<p><img src="notes-on-statistical-rethinking_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>The stripes show uncertainty (estimate ± standard error) and you can appreciate how quickly it is reduced as marriage rate becomes noisier and just how little noise is required for “magic” to start working and converge on the true causal relationships.</p>
</div>
<div id="warning" class="section level2" number="3.6">
<h2><span class="header-section-number">3.6</span> Warning</h2>
<p>So, a bit of noise will fix everything? Not necessarily! If <em>both</em> marriage age and rate depend on some <em>third latent variable</em>, it will depend, for example, on which variable is noisier. The book will continue with this theme, so you will learn more but, in the meantime, the key take-home message is still “doing multiple regression is easy, understanding and interpreting it is hard.”</p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="3">
<li id="fn3"><p>Dear electric engineers, yes, I know that’s not quite how it works but it is still a good metaphor!<a href="multiple-regression-and-causal-reasoning.html#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>If you feel that science is not about guessing, you are wrong and I have Richard Feynman on my side! You always start by guessing a particular law or rule and then use empirical data to check whether your guess was correct. If you made an <em>educated</em> guess, your chances of it being correct are higher, so your job is to study the field and prior work to make your guess as educated as possible. But, at the end, it is still a guess and it can be wrong. Good news, at least in my experience, is that guesses that turn out to be spectacularly wrong are the most informative ones, as they reveal something unexpected and, thus, hitherto unknown about the process.<a href="multiple-regression-and-causal-reasoning.html#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>The data is “standardized,” therefore, age of 1 is one standard deviation away from the mean marriage rate.<a href="multiple-regression-and-causal-reasoning.html#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>As you will learn later, the opposite is also true, so you can turn independence into conditional dependence.<a href="multiple-regression-and-causal-reasoning.html#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p>Don’t be like me, be better!<a href="multiple-regression-and-causal-reasoning.html#fnref7" class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p>I’ve made priors for both betas broad, so that they are not pushed towards zero too aggressively and their uncertainty is more evident<a href="multiple-regression-and-causal-reasoning.html#fnref8" class="footnote-back">↩︎</a></p></li>
<li id="fn9"><p>I’ve dropped likelihood and variance only to compress formulas and shed unimportant details. Adding them does not change the essence.<a href="multiple-regression-and-causal-reasoning.html#fnref9" class="footnote-back">↩︎</a></p></li>
<li id="fn10"><p>in our case, the difference, because we defined that <code>M = -A</code><a href="multiple-regression-and-causal-reasoning.html#fnref10" class="footnote-back">↩︎</a></p></li>
<li id="fn11"><p>I’ve used ordinary least squares just to make simulations faster. You will get the same result using Bayesian fittings procedures.<a href="multiple-regression-and-causal-reasoning.html#fnref11" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="loss-functions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="solutions-for-chapter-2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["notes-on-statistical-rethinking.pdf", "notes-on-statistical-rethinking.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
